---
import BaseLayout from "../layouts/BlogPost.astro";
import { SITE_DESCRIPTION, SITE_TITLE } from "../consts";
import BannerStrip from "../components/BannerStrip.astro";

import Hero from "../components/Hero.astro";

const base = import.meta.env.BASE_URL;
const heroImg = `${base}images/pages/LF_Home.png`;
const services = [
  {
    title: "Famiglie",
    href: `${base}servizi/famiglia`,
    image: `${base}images/servizi/LF_Servizi_Famiglia.png`,
    accent: "#6B8CC3",
    description:
      "Servizi per lo sviluppo delle competenze ad apprendere nelle relazioni di bambini e giovani.",
  },
  {
    title: "Scuole",
    href: `${base}servizi/scuole`,
    image: `${base}images/servizi/LF_Servizi_Scuola.png`,
    accent: "#7A9B6D",
    description:
      "Progetti e risorse per la promozione della convivenza scolastica.",
  },
  {
    title: "Territori e organizzazioni",
    href: `${base}servizi/territori`,
    image: `${base}images/servizi/LF_Servizi_Territorio.png`,
    accent: "#C08A5A",
    description:
      "Reti di prossimità tra cittadini e agenzie territoriali utili all’integrazione sociale delle persone.",
  },
  {
    title: "Consulenza alla persona",
    href: `${base}servizi/consulenza`,
    image: `${base}images/servizi/LF_Servizi_Persona2.png`,
    accent: "#8F7BC2",
    description:
      "Consulenze psicoterapeutiche per lo sviluppo creativo ed integrato delle persone.",
  },
];
---

<BaseLayout title={SITE_TITLE} description={SITE_DESCRIPTION}>
  
  <section class="logo-splash full-bleed" aria-hidden="true">
        <img
          src={`${base}images/logo/LF_logo-completo.png`}
          alt="Lessico Familiare"
          class="logo-splash__img"
          loading="eager"
        />
      </section>


  <div class="home-content">
    
    <section>
      
  <Hero
    image={heroImg}
    imageAlt="Dettaglio di uno spazio di lavoro"
    align="left"
    size="md"
  />
      <BannerStrip title="COSTRUIRE CONTESTI PER LO SVILUPPO E LA CREATIVITÀ SOCIALE" />
      
    </section>

  <section class="mt-10">
    <div class="max-w-3xl">
      <p class="mt-3 text-slate-600">
        Lessico Familiare è uno studio di psicoterapia che interviene sui problemi che persone ed organizzazioni vivono nei propri contesti di riferimento. 
        Lavoriamo alla costruzione di contesti relazionali creativi e produttivi
        tra le persone, che permettano di sostenere i desideri di sviluppo di
        ciascuno.
      </p>
      <p class="mt-4 text-slate-600">
        Accompagniamo i percorsi di crescita di bambini, giovani e delle loro
        famiglie. Interveniamo sull’elaborazione delle emozioni legate ai
        processi di apprendimento e socializzazione, sia con singoli che con
        consulenze a istituzioni scolastiche e luoghi della cultura. Il lavoro
        si declina contestualmente in diversi setting quali lo studio, il
        domicilio e online.
      </p>
    </div>
    
      <BannerStrip title="Servizi" />

    <div class="mt-8 grid gap-5 md:grid-cols-2">
      {services.map((service) => (
        <a
          href={service.href}
          class="group relative overflow-hidden rounded-2xl border border-slate-200 bg-white transition hover:-translate-y-0.5 hover:shadow-md"
        >
          <div class="relative aspect-[16/9] overflow-hidden bg-slate-100">
            <img
              src={service.image}
              alt={service.title}
              class="h-full w-full object-cover transition duration-700 group-hover:scale-105"
              loading="lazy"
              decoding="async"
            />
            <div
              class="absolute inset-0 opacity-80 transition group-hover:opacity-90"
              style={`background: linear-gradient(120deg, ${service.accent}cc, rgba(0,0,0,0.15));`}
            ></div>
          </div>
          <div class="p-5">
            <h3 class="text-lg font-semibold">{service.title}</h3>
            <p class="mt-2 text-sm text-slate-600">{service.description}</p>
          </div>
          <div
            class="pointer-events-none absolute inset-x-0 bottom-0 h-1 opacity-0 transition group-hover:opacity-100"
            style={`background: ${service.accent};`}
          ></div>
        </a>
      ))}
    </div>

    <section
      class="mt-12 rounded-2xl p-8"
      style="background: var(--brand-soft); box-shadow: var(--box-shadow);"
    >
      <div class="flex flex-col gap-4 md:flex-row md:items-center md:justify-between">
        <div>
          <h3 class="text-2xl font-semibold" style="color: var(--brand-dark);">
            Contattaci
          </h3>
          <p class="mt-2 text-sm" style="color: var(--muted);">
            Se vuoi orientarti sui servizi più adatti, scrivici.
          </p>
        </div>
        <a
          href={`${base}contatti`}
          class="inline-flex items-center justify-center rounded-xl px-5 py-3 text-sm font-semibold !text-white hover:opacity-90 transition"
          style="background: var(--brand);"
        >
          Scrivici
        </a>
      </div>
    </section>
  </section>
  </div>
</BaseLayout>

<style>
  :global(main) {
    padding-top: 0;
  }
  .logo-splash {
    position: fixed;
    inset: 0;
    z-index: 40;
    display: flex;
    align-items: center;
    justify-content: center;
    background: #fff;
    opacity: var(--logo-opacity, 1);
    pointer-events: var(--logo-splash-pe, auto);
    transition: opacity 200ms ease;
  }
  .logo-splash__img {
    width: min(92vw, 1500px);
    height: auto;
    transform: translateY(var(--logo-shift, 0px)) scale(var(--logo-scale, 1));
    opacity: var(--logo-opacity, 1);
    animation: logoFloatIn 1800ms ease both;
    will-change: transform;
  }
  @keyframes logoFloatIn {
    from {
      transform: translateY(12px) scale(0.985);
    }
    to {
      transform: translateY(var(--logo-shift, 0px)) scale(var(--logo-scale, 1));
    }
  }
  @media (prefers-reduced-motion: reduce) {
    .logo-splash__img {
      animation: none;
      transform: none;
      opacity: 1;
    }
    .logo-splash {
      display: none;
    }
    .home-content {
      opacity: 1;
    }
  }
  .home-content {
    opacity: 1;
    transition: opacity 300ms ease;
  }
  :global(.has-splash) .home-content {
    opacity: var(--home-content-opacity, 0);
  }
</style>

<script is:inline>
  (() => {
    const prefersReduced = window.matchMedia("(prefers-reduced-motion: reduce)").matches;
    if (prefersReduced) return;

    const splash = document.querySelector(".logo-splash");
    if (!splash) return;

    document.documentElement.classList.add("has-splash");

    let progress = 0;
    let ticking = false;
    const clamp = (min, value, max) => Math.max(min, Math.min(value, max));

    const update = () => {
      ticking = false;
      const scale = clamp(1, 1 + progress * 0.25, 1.25);
      const opacity = clamp(0, 1 - progress * 1.1, 1);
      const fadeStartOpacity = 0.1;
      const contentOpacity = opacity > fadeStartOpacity
        ? 0
        : clamp(0, (fadeStartOpacity - opacity) / fadeStartOpacity, 1);
      splash.style.setProperty("--logo-scale", scale.toFixed(3));
      splash.style.setProperty("--logo-opacity", opacity.toFixed(3));
      document.documentElement.style.setProperty(
        "--home-content-opacity",
        contentOpacity.toFixed(3),
      );
      const done = progress >= 1;
      document.documentElement.classList.toggle("has-splash", !done);
      splash.style.setProperty("--logo-splash-pe", done ? "none" : "auto");
      document.body.style.overflow = done ? "" : "hidden";
    };

    const requestUpdate = () => {
      if (!ticking) {
        ticking = true;
        requestAnimationFrame(update);
      }
    };

    const onWheel = (event) => {
      const atTop = window.scrollY <= 0;
      const direction = Math.sign(event.deltaY);
      const shouldControl =
        progress < 1 || (atTop && direction < 0);

      if (!shouldControl) return;
      event.preventDefault();
      progress = clamp(0, progress + event.deltaY / 1000, 1);
      requestUpdate();
    };

    let lastTouchY = null;
    const onTouchMove = (event) => {
      if (event.touches.length !== 1) return;
      const touchY = event.touches[0].clientY;
      if (lastTouchY !== null) {
        const delta = lastTouchY - touchY;
        const atTop = window.scrollY <= 0;
        const shouldControl = progress < 1 || (atTop && delta < 0);
        if (shouldControl) {
<<<<<<< HEAD
          progress = clamp(0, progress + delta / 250, 1);
=======
          progress = clamp(0, progress + delta / 200, 1);
>>>>>>> 55993fc (Update home splash scroll behavior)
          requestUpdate();
          event.preventDefault();
        }
      }
      lastTouchY = touchY;
    };
    const onTouchEnd = () => {
      lastTouchY = null;
    };

    const onKeyDown = (event) => {
      const downKeys = ["ArrowDown", "PageDown", " "];
      const upKeys = ["ArrowUp", "PageUp"];
      if (![...downKeys, ...upKeys].includes(event.key)) return;
      const atTop = window.scrollY <= 0;
      const direction = downKeys.includes(event.key) ? 1 : -1;
      const shouldControl = progress < 1 || (atTop && direction < 0);
      if (!shouldControl) return;
      event.preventDefault();
      progress = clamp(0, progress + direction * 0.08, 1);
      requestUpdate();
    };

    document.body.style.overflow = "hidden";
    update();
    window.addEventListener("wheel", onWheel, { passive: false });
    window.addEventListener("touchmove", onTouchMove, { passive: false });
    window.addEventListener("touchend", onTouchEnd, { passive: true });
    window.addEventListener("touchcancel", onTouchEnd, { passive: true });
    window.addEventListener("keydown", onKeyDown);
  })();
</script>
