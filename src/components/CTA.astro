---
const {
  title,
  text,
  href = "/contatti",
  buttonLabel = "Scrivici",
} = Astro.props;
---

<section
  class="mt-12 rounded-2xl p-8"
  style="background: var(--brand-soft); box-shadow: var(--box-shadow);"
>
  <div class="flex flex-col gap-4 md:flex-row md:items-center md:justify-between">
    <div>
      <h3 class="text-2xl font-semibold" style="color: var(--brand-dark);">
        {title}
      </h3>
      <p class="mt-2 text-sm" style="color: var(--bg);">
        {text}
      </p>
    </div>
    <a
      href={href}
      data-cta-track
      data-cta-title={title}
      data-cta-label={buttonLabel}
      data-cta-href={href}
      class="inline-flex items-center justify-center rounded-xl px-5 py-3 text-sm font-semibold !text-white hover:opacity-90 transition"
      style="background: var(--brand-dark);"
    >
      {buttonLabel}
    </a>
  </div>
</section>

<script is:inline>
  (() => {
    if (window.__lfCtaTracking) return;
    window.__lfCtaTracking = true;

    document.addEventListener("click", (event) => {
      const target = event.target instanceof Element ? event.target : null;
      const link = target?.closest?.("[data-cta-track]");
      if (!link) return;

      window.umami?.track("CTA: Click", {
        title: link.getAttribute("data-cta-title") || "",
        label: link.getAttribute("data-cta-label") || "",
        href: link.getAttribute("data-cta-href") || "",
        path: window.location.pathname,
      });
    });
  })();
</script>
